// Header & navigation
.oa-header {
  position: sticky;
  top: 0;
  z-index: 50;

  // expanded state (default)
  .bulma-navbar {
    transition: all .25s ease;
    min-height: 100px;
    padding-block: 0;

    .bulma-navbar-link,
    .bulma-navbar-item {
      text-decoration: none;
    }
  }

  // condensed state (on scroll)
  &.is-condensed {
    .bulma-navbar {
      min-height: 50px;
    }
  }

  // let the dropdown overflow the bar so hover doesn't break
  .bulma-navbar,
  .bulma-navbar-menu {
    overflow: visible;
  }

  .bulma-navbar-link,
  .bulma-navbar-item {
    font-size: .9rem;

    // remove Bulma’s default carets from navbar links
    &[data-no-caret]::after {
      display: none;
    }

    // a11y
    &:focus-visible {
      outline: 2px solid var(--bulma-link);
      outline-offset: 2px;
      box-shadow: none;
    }

    // stop Bulma hover bg tint
    &:hover,
    &:focus,
    &:focus-within,
    &.bulma-is-active {
      background: transparent;
      --bulma-navbar-item-background-a: 0;
    }

    // display & keep underline while hovering the dropdown panel
    &.bulma-has-dropdown:hover > .bulma-navbar-link,
    &.bulma-has-dropdown:focus > .bulma-navbar-link,
    &.bulma-has-dropdown:focus-within > .bulma-navbar-link {
      text-decoration-line: underline;
      text-decoration-color: var(--oa-colour-paper);
      text-decoration-thickness: 2.5px;
      text-underline-offset: 10px;
    }
  }

  .bulma-navbar-dropdown .bulma-navbar-item {
    font-weight: 600;
  }
}

// Megamenu (desktop)
@media screen and (min-width: 1024px) {
  .oa-header .bulma-navbar { 
    position: relative; 
  }

  .oa-header .bulma-navbar-item.bulma-has-dropdown {
    position: static;
  }

  .oa-header .oa-megamenu {
    position: absolute;
    left: 0;
    right: 0;
    top: 100%;
    width: 100vw;
    margin-left: calc(50% - 50vw);
    display: none;
    background: var(--bulma-brand);
    border: 0;
    padding: 0;
    overflow: visible;
  }

  .oa-header .bulma-navbar-item.bulma-has-dropdown.bulma-is-hoverable:hover > .oa-megamenu,
  .oa-header .bulma-navbar-item.bulma-has-dropdown:focus-within > .oa-megamenu {
    display: block;
  }

  .oa-header .oa-megamenu .bulma-columns {
    display: flex;
    flex-wrap: wrap;
    margin-left: 0;
    margin-right: 0;
  }

  .oa-header .oa-megamenu .bulma-column {
    padding-left: 0;
    padding-right: 0;
  }

  // remove Bulma’s white tile background in dropdown
  .oa-header .bulma-navbar-dropdown a.bulma-navbar-item,
  .oa-header .bulma-navbar-dropdown .bulma-navbar-item {
    background: transparent;
  }

  .oa-header .oa-megamenu .bulma-navbar-item {
    display: block;
    padding: .875rem 1rem;
    text-align: left;
    white-space: normal;
    word-break: normal;
    overflow-wrap: normal;
    transition: background-color .15s ease, color .15s ease;
    color: var(--bulma-paper);

    &:not(.is-active, .is-selected) {
      color: var(--bulma-paper);
    }

    &:hover,
    &:focus,
    &:focus-visible,
    &.bulma-is-active {
      background: color-mix(in srgb, var(--bulma-brand) 15%, var(--bulma-paper));
      color: var(--bulma-ink);
      outline: 0;
    }
  }
}

// Megamenu (mobile)
@media (max-width: 1023.98px) {
  // .98 here is to avoid conflict with the 1024px breakpoint in Bulma

  .bulma-navbar-menu { 
    display: none; 
  }

  .bulma-navbar-menu.bulma-is-active { 
    display: block; 
  }

  .oa-nav-mobile {
    background: var(--bulma-scheme-invert);
    color: var(--bulma-scheme-main);
    padding: .25rem 0;
    max-height: calc(100vh - 72px); // fallback
    max-height: calc(100dvh - 72px); // modern viewports
    -webkit-overflow-scrolling: touch;
    overflow-y: auto;
    overscroll-behavior: contain;
    scrollbar-gutter: stable;

    .bulma-navbar-item > .bulma-navbar-link {
      color: var(--bulma-scheme-main);
      font-weight: 700;
      padding: .5rem 1rem;
      min-height: 44px;
      border-top: 1px solid var(--bulma-border, currentColor);
    }
    .bulma-navbar-item:first-child > .bulma-navbar-link { border-top: 0; }

    .oa-megamenu {
      background: var(--bulma-scheme-invert);
      margin: 0;
      padding: 0;

      .bulma-navbar-item {
        background: var(--bulma-scheme-invert);
        color: var(--bulma-scheme-main);
        font-weight: 400;
        padding: .4375rem 1rem;
        white-space: normal;
        text-align: left;

        &:hover,
        &:focus { 
          font-weight: 600; 
        }
      }
    }
  }

  .oa-header {
    // align logo and burger vertically
    .bulma-container,
    .bulma-navbar-brand,
    .bulma-navbar-brand .bulma-navbar-item,
    .bulma-navbar-burger {
      min-height: inherit;
    }
    
    // allow scrolling when condensed
    &.is-condensed .oa-nav-mobile {
      max-height: calc(100vh - 52px);
      max-height: calc(100dvh - 52px);
      overflow-y: auto; 
    }
  }
}